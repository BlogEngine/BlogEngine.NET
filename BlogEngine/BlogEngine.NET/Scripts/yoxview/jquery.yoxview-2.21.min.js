!function(a){function b(){function va(a){for(var b=$.length,c=0;c<b;c++)if(Yox.compare($[c],a))return c;return $.push(a),b}function wa(a){return"a:has(img)"+(null!==a.textLinksSelector?",a"+a.textLinksSelector:"")}function xa(c,d){if(c.skin){var e=c.skin;if(a.yoxview.yoxviewSkins[e])d&&d(a.yoxview.yoxviewSkins[e]);else{var f=b+"skins/"+e+"/yoxview."+e;a.ajax({url:f+".js",dataType:"script",success:function(b){a.yoxview.yoxviewSkins[e].css!==!1&&Yox.addStylesheet(top.document,f+".css"),d&&d(a.yoxview.yoxviewSkins[e])},error:function(){alert("Error loading skin file "+f+".js")}})}}else d&&d(a.yoxview.yoxviewSkins[e])}function ya(c,d){if(sa[c])d&&d(sa[c]);else{sa[c]={};var e=b+"lang/"+c+".js";a.ajax({url:e,async:!1,dataType:"json",success:function(a){sa[c]=a,d&&d(a)},error:function(){alert("Error loading language file "+e)}})}}function za(){ca&&(ia.remove(),ca=void 0,ja=void 0,W=void 0,w=void 0,x=void 0,_=void 0,aa=void 0,j=0,a.yoxview.infoButtons={}),Oa()}function Aa(a){var b=a.data("yoxview");if(!y||n!=b.viewIndex){b.cacheVars||(b.cacheVars={cachedImagesCount:0,cacheDirectionForward:!0,cacheBufferLastIndex:null,currentCacheImg:0}),y=b.images,z=y.length,n=b.viewIndex;var c=!1,d=!m||m!=b.optionsSet;d&&(m=b.optionsSet||0,Z=$[m],c=!0),Z.onLoadImages?Z.onLoadImages({images:y,viewData:b}):(ja&&1==z||ca&&!ja&&z>0)&&(c=!0),c&&za(),e=b.cacheVars}}function Ba(a,b,c){var d=b&&(b.width||b.height)?{width:parseInt(b.width),height:parseInt(b.height)}:c.defaultDimensions[a];return isNaN(d.width)&&(d.width=null),isNaN(d.height)&&(d.height=null),d}function Da(b,c){var d={},e=b.attr("href"),f=b.children("img:first");0==f.length&&(f=b);var d={};for(supportedType in Ca){var g=Ca[supportedType](b,e,f,c);if(g){a.extend(g,{contentType:supportedType,elementId:i++}),d.media=g;break}}return d.media?(d.thumbnailImg=f,d):null}function Ea(b,c,d,e){var f=function(b){var c=a(b.currentTarget).data("yoxview");return!c||null===c.imageIndex||(b.preventDefault(),void a.yoxview.open(a(b.liveFired||b.currentTarget).data("yoxview").viewIndex,c.imageIndex))};"A"==b[0].tagName?b.bind("click.yoxview",f):d?b.yoxthumbs(a.extend({images:d,enableOnlyMedia:!1,onClick:e||function(b){return b.preventDefault(),c.thumbnailsOptions&&c.thumbnailsOptions.onClick?c.thumbnailsOptions.onClick(a(b.currentTarget).data("yoxview").imageIndex,a(b.currentTarget),a(b.liveFired).data("yoxview").viewIndex):a.yoxview.open(a(b.liveFired||b.currentTarget).data("yoxview").viewIndex,a(b.currentTarget).data("yoxview").imageIndex),!1}},c.thumbnailsOptions)):b.delegate(wa(c),"click.yoxview",f)}function Fa(b){var c=N[n];if(na="A"==c[0].tagName?c:y[j].thumbnailImg,na&&0!=na.length||(na=y[0].thumbnailImg),na){var d=na.attr("src");b&&w&&d&&w.attr("src",d),o&&!s&&window.name&&(s=a(top.document).find("[name='"+window.name+"']").offset()),pa=na.offset(),qa={width:na.width(),height:na.height(),top:Math.round(pa.top-ha.scrollTop()+(s?s.top:0)),left:Math.round(pa.left+(s?s.left:0))}}}function Ga(a){0==a.css("opacity")&&a.stop().animate({opacity:0},Z.buttonsFadeTime,Ja(a))}function Ha(b){X.css("background-position",la.getBackgroundPosition("notifications",b)),X.stop().fadeIn(Z.buttonsFadeTime,function(){a(this).delay(500).fadeOut(Z.buttonsFadeTime)})}function Ja(b){a(b).stop().animate({opacity:.5},Z.buttonsFadeTime)}function Ka(b){if(a.yoxview&&a.yoxview.isOpen){var c=ta[b.keyCode],d=a.yoxview[ua[c]];return!d||(b.preventDefault(),d.apply(a.yoxview),!1)}return!0}function La(b,c,d){var e=a("<a>",{href:"#",click:function(){return a.yoxview.clickBtn(a.yoxview[c],d)}}),f=a("<span>"+b+"</span>");return f.css("opacity","0").appendTo(e),e.append(la.getSprite("icons",c)),e}function Ma(b,c,d){var e=new Image;e.src=Z.imagesFolder+c+".png";var f=a("<a>",{css:{background:"url("+e.src+") no-repeat "+c+" center",opacity:"0",outline:"0"},class:"yoxview_ctlBtn",href:"#"});return f.css(c,"0"),d?f.css("cursor","default"):(f.click(function(){return this.blur(),a.yoxview.clickBtn(b,!0)}),0!=Z.buttonsFadeTime&&f.hover(function(){a.yoxview.isOpen&&a(this).stop().animate({opacity:.6},Z.buttonsFadeTime)},function(){a(this).stop().animate({opacity:0},Z.buttonsFadeTime)})),f}function Na(){var b="number"==typeof Z.popupMargin?[String(Z.popupMargin)]:Z.popupMargin.split(" ",4);switch(ea.top=parseInt(b[0]),b.length){case 1:ea.bottom=ea.right=ea.left=ea.top;break;case 2:ea.bottom=ea.top,ea.right=ea.left=parseInt(b[1]);break;case 3:ea.bottom=parseInt(b[2]),ea.right=ea.left=parseInt(b[1]);break;default:a.extend(ea,{right:parseInt(b[1]),bottom:parseInt(b[2]),left:parseInt(b[3])})}ea.totalHeight=ea.top+ea.bottom,ea.totalWidth=ea.left+ea.right,Z.renderInfoExternally&&a.extend(fa,ea)}function Oa(){Na(),ra=ab(),la=new Yox.Sprites({notifications:{width:59,height:59,sprites:["empty","playRTL","play","pause","last","first"]},icons:{width:18,height:18,sprites:["close","help","playpause","link","pin","unpin","play","pause","right","left"]},menu:{height:42,sprites:["back"]}},Z.imagesFolder+"sprites.png",Z.imagesFolder+"empty.gif"),ua={RIGHT:Z.isRTL?"prev":"next",DOWN:"next",UP:"prev",LEFT:Z.isRTL?"next":"prev",ENTER:"play",HOME:"first",END:"last",SPACE:"next",h:"help",ESCAPE:"close"},k=sa[Z.lang];var b=Z.skin?a.yoxview.yoxviewSkins[Z.skin]:null;ca=a("<div>",{id:"yoxview",click:function(a){a.stopPropagation()}}),ia=a("<div>",{id:"yoxview_popupWrap",click:function(b){b.preventDefault(),a.yoxview.clickBtn(a.yoxview.close,!0)}}),Z.skin&&ia.attr("class","yoxview_"+Z.skin),0===Z.backgroundOpacity?ia.css("background","none"):Yox.Support.rgba()&&ia.css("background-color",Yox.hex2rgba(Z.backgroundColor,Z.backgroundOpacity)),ia.appendTo(a(top.document.getElementsByTagName("body")[0])).append(ca),_=a("<div>",{class:"yoxview_imgPanel",css:{"z-index":"2"}}),aa=a("<div>",{class:"yoxview_imgPanel",css:{"z-index":"1",display:"none"}}),w=a("<img />",{class:"yoxview_fadeImg",css:{display:"block",width:"100%",height:"100%"}}),x=a("<img />",{class:"yoxview_fadeImg",css:{display:"block",width:"100%",height:"100%"}}),_.data("yoxviewPanel",{image:w}).append(w).appendTo(ca),aa.data("yoxviewPanel",{image:x}),aa.append(x).appendTo(ca);var c=1==z;if(c&&!y[0].media.title&&(Z.renderInfo=!1),Z.renderMenu!==!1){var e=a("<div>",{class:"yoxview_popupBarPanel yoxview_top"});Z.autoHideMenu!==!1&&e.hover(function(){a.yoxview.isOpen&&fb()},function(){a.yoxview.isOpen&&eb()}),V=a("<div>",{id:"yoxview_menuPanel"}),Yox.Support.rgba()&&Z.menuBackgroundColor&&V.css("background",Yox.hex2rgba(Z.menuBackgroundColor,Z.menuBackgroundOpacity||.8));var f=La(k.Help,"help",!1);a.yoxview.infoButtons.playBtn=La(k.Slideshow,"play",!1),ba=a.yoxview.infoButtons.playBtn.children("span"),V.append(La(k.Close,"close",!0),f,a.yoxview.infoButtons.playBtn),c&&(a.yoxview.infoButtons.playBtn.css("display","none"),f.css("display","none"),V.css({width:58})),V.find("a:last-child").attr("class","last"),e.append(V).appendTo(ca),V.delegate("a","mouseenter",function(){a(this).stop().animate({top:"8px"},"fast").find("span").stop().animate({opacity:1},"fast")}).delegate("a","mouseleave",function(){a(this).stop().animate({top:"0"},"fast").find("span").stop().animate({opacity:0},"fast")})}Z.renderButtons===!1||c&&a.support.opacity?h=a():(ja=Ma(a.yoxview.prev,Z.isRTL?"right":"left",c),W=Ma(a.yoxview.next,Z.isRTL?"left":"right",c),ca.append(ja,W),h=c&&!a.support.opacity?a():ca.find(".yoxview_ctlBtn")),d=a("<div>",{id:"yoxview_ajaxLoader",class:"yoxview_notification",css:{display:"none"}}),d.append(a("<img>",{src:Z.imagesFolder+"popup_ajax_loader.gif",alt:k.Loading,css:{width:32,height:32,"background-image":"url("+Z.imagesFolder+"sprites.png)","background-position":la.getBackgroundPosition("notifications","empty")}})).appendTo(ca),Z.disableNotifications||(X=a("<img>",{class:"yoxview_notification"}),ca.append(X)),t=a("<div>",{id:"yoxview_helpPanel",href:"#",title:k.CloseHelp,css:{background:"url("+Z.imagesFolder+"help_panel.png) no-repeat center top",direction:k.Direction,opacity:"0"},click:function(){return a.yoxview.clickBtn(a.yoxview.help,!1)}});var i=document.createElement("h1");i.innerHTML=k.Help.toUpperCase();var j=document.createElement("p");j.innerHTML=k.HelpText;var l=document.createElement("span");if(l.id="yoxview_closeHelp",l.innerHTML=k.CloseHelp,t.append(i).append(j).append(l).appendTo(ca),Z.renderInfo!==!1){if(A=a("<div>",{id:"yoxview_infoPanel",click:function(a){a.stopPropagation()}}),0===Z.infoBackOpacity?(A.css("background","none"),B=A):Yox.Support.rgba()?(B=A,A.css("background-color",Yox.hex2rgba(Z.infoBackColor,Z.infoBackOpacity))):(A.append(a("<div>",{id:"yoxview_infoPanelBack",css:{background:Z.infoBackColor,opacity:Z.infoBackOpacity}})),B=a("<div>",{id:"yoxview_infoPanelContent"})),g=a("<span>",{id:"yoxview_count"}),H=a("<div>",{id:"yoxview_infoText"}),c&&(H.css("margin-left","10px"),g.css("display","none")),B.append(g),Z.renderInfoPin!==!1&&(G=la.getSprite("icons",Z.autoHideInfo?"pin":"unpin"),F=a("<a>",{class:"yoxviewInfoLink",href:"#",title:Z.autoHideInfo?k.PinInfo:k.UnpinInfo,css:{display:"inline"},click:function(a){a.preventDefault(),Z.autoHideInfo=!Z.autoHideInfo,G.css("background-position",la.getBackgroundPosition("icons",Z.autoHideInfo?"pin":"unpin")),this.title=Z.autoHideInfo?k.PinInfo:k.UnpinInfo}}),F.append(G).appendTo(B)),b&&b.infoButtons){var m=b.infoButtons(Z,k,la,ia,ca);Z.infoButtons?a.extend(Z.infoButtons,m):Z.infoButtons=m}if(Z.infoButtons){a.extend(a.yoxview.infoButtons,Z.infoButtons);for(infoButton in Z.infoButtons)Z.infoButtons[infoButton].attr("class","yoxviewInfoLink").css("display","block").appendTo(B)}Z.linkToOriginalContext!==!1&&(C=a("<a>",{class:"yoxviewInfoLink",target:"_blank",title:k.OriginalContext}),C.append(la.getSprite("icons","link")).appendTo(B)),B.append(H),Yox.Support.rgba()||A.append(B),A.appendTo(Z.renderInfoExternally?ia:ca),Z.renderInfoExternally||(E=a("<div>",{class:"yoxview_popupBarPanel yoxview_bottom"}),E.hover(function(){a.yoxview.isOpen&&!p&&Z.autoHideInfo!==!1&&cb()},function(){a.yoxview.isOpen&&!p&&Z.autoHideInfo!==!1&&db()}),A.wrap(E),E=A.parent())}Yox.Support.rgba()||(da=a("<div>",{css:{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",background:Z.backgroundColor,"z-index":"1",opacity:Z.backgroundOpacity}}).appendTo(ia))}function Pa(){e.cachedImagesCount++,e.cachedImagesCount==z?e.cacheComplete=!0:Qa()}function Qa(){Z.cacheBuffer&&e.currentCacheImg==e.cacheBufferLastIndex||Sa(e.currentCacheImg+(e.cacheDirectionForward?1:-1))}function Ra(){Z.cacheBuffer&&(e.cacheBufferLastIndex=e.cacheDirectionForward?j+Z.cacheBuffer:j-Z.cacheBuffer,e.cacheBufferLastIndex<0?e.cacheBufferLastIndex+=z:e.cacheBufferLastIndex>=z&&(e.cacheBufferLastIndex-=z))}function Sa(a){if(!e.cacheComplete){a==z?a=0:a<0&&(a+=z);var b=y[a].media;e.currentCacheImg=a,b&&!b.loaded?b.contentType&&"image"!==b.contentType?kb(b,function(){Pa()}):f.src=b.src:Qa()}}function Ta(){P=!0,clearTimeout(O),d.stop(),O=setTimeout(function(){d.css("opacity","0.6").fadeIn(Z.buttonsFadeTime)},Z.buttonsFadeTime)}function Ua(){P=!1,clearTimeout(O),d.stop().fadeOut(Z.buttonsFadeTime)}function Va(b){K||Ta(),jb(a.yoxview.currentImage.media)}function Wa(a,b){ca.stop().animate(a,Z.popupResizeTime,b)}function Xa(){1!=z&&(K=!0,ba?ba.text(k.Pause):a.yoxview.infoButtons.playBtn&&a.yoxview.infoButtons.playBtn.attr("title",k.Pause),a.yoxview.infoButtons.playBtn&&a.yoxview.infoButtons.playBtn.find("img").css("background-position",la.getBackgroundPosition("icons","pause")),j<z-1?ga=setTimeout(function(){a.yoxview.next(!0)},Z.playDelay):(Z.loopPlay?ga=setTimeout(function(){a.yoxview.select(0,null)},Z.playDelay):Ya(),Z.onEnd&&setTimeout(Z.onEnd,Z.playDelay)))}function Ya(){clearTimeout(ga),K=!1,ba?ba.text(k.Play):a.yoxview.infoButtons.playBtn&&a.yoxview.infoButtons.playBtn.attr("title",k.Play),a.yoxview.infoButtons.playBtn&&a.yoxview.infoButtons.playBtn.find("img").css("background-position",la.getBackgroundPosition("icons","play"))}function ab(){var a=ha.width(),b=ha.height(),c={height:b,width:a,usableArea:{height:b-ea.totalHeight,width:a-ea.totalWidth}};return c}function bb(a){var b=a.width&&a.height?Yox.fitImageSize(a,ra.usableArea):{width:a.width?Math.min(a.width,ra.usableArea.width):ra.usableArea.width,height:a.height?Math.min(a.height,ra.usableArea.height):ra.usableArea.height};return b.top=ea.top+Math.round((ra.usableArea.height-b.height)/2),b.left=ea.left+Math.round((ra.usableArea.width-b.width)/2),b}function cb(b){clearTimeout(u);var c=H.outerHeight();c<D&&(c=D),A.height()!==c&&A.stop().animate({height:c},500,function(){if(Z.renderInfoExternally){var d=A.position();a.extend(ea,fa),0===d.top?ea.top+=c:ea.bottom+=c,ea.totalHeight=ea.top+ea.bottom,ra=ab(),a.yoxview.resize(!1)}b&&b()})}function db(a){clearTimeout(u),A.stop().animate({height:0},500,function(){a&&a()})}function eb(a){V&&(clearTimeout(v),V.stop().animate({top:U},500,function(){a&&a()}))}function fb(a){V&&(clearTimeout(v),V.stop().animate({top:0},500,function(){a&&a()}))}function gb(){_a=$a,$a=I?aa:_,I=!I}function hb(b){var c="image"===b.contentType||!b.contentType;c&&p&&E&&E.css("display","block"),clearTimeout(u),gb();var d=$a.data("yoxviewPanel");if(l.width=b.width,l.height=b.height,l.padding=b.padding,A){var f=b.title||"";Z.showDescription&&b.description&&(f+=""!=f?"<div id='yoxview_infoTextDescription'>"+b.description+"</div>":b.description),H.html(f),z>1&&g.html(j+1+"/"+z),C&&(a.yoxview.currentImage.link?C.attr("href",a.yoxview.currentImage.link).css("display","inline"):C.css("display","none"))}var i=bb(b);c?(currentImageElement=I?w:x,currentImageElement.attr({src:b.src,title:b.title,alt:b.alt}),d.image=currentImageElement,!d.isImage&&d.element&&(d.element.css("display","none"),d.image.css("display","block"),d.isImage=!0),J||(Z.renderButtons&&h.css({height:"100%",width:"50%",top:"0"}),p=!1,J=!0)):(d.element&&d.elementId!=b.elementId&&(d.element.remove(),d.element=void 0),d.element||(b.html?(d.element=a("<div>",{class:S}),ca.append(d.element)):(ca.append(b.element),d.element=b.element)),b.html&&d.element.html(b.html),$a=d.element,J&&(E&&(Z.autoHideInfo!==!1&&db(),E.css("display","none"),p=!0),Z.renderButtons&&h.css({width:Q.width,height:Q.height}),J=!1),Z.renderButtons&&h.css({top:(i.height-Q.height)/2}),(void 0===d.isImage||d.isImage)&&(d.element.css("display","block"),d.image.css("display","none"),d.isImage=!1));var k={width:i.width,height:i.height};$a.css(r?{width:"100%",height:"100%"}:k),P&&Ua(),L=!0,Wa(i,function(){if(r&&(a.yoxview.isOpen=!0,$a.css(k),Z.controlsInitialDisplayTime>0&&(Z.showButtonsOnOpen&&h.animate({opacity:.5},Z.controlsInitialFadeTime,function(){0!=Z.buttonsFadeTime&&a(this).delay(Z.controlsInitialDisplayTime).animate({opacity:0},Z.controlsInitialFadeTime)}),Z.showBarsOnOpen&&(fb(function(){Z.autoHideMenu!==!1&&(v=setTimeout(function(){eb()},Z.controlsInitialDisplayTime))}),A&&cb(function(){Z.autoHideInfo!==!1&&(u=setTimeout(function(){db()},Z.controlsInitialDisplayTime))}))),Z.autoPlay&&a.yoxview.play(),Z.onOpen&&Z.onOpen(),Y&&(Y(),Y=void 0),r=!1),l.padding){var b=ca.width(),c=ca.height();l.padding&&(b-=l.padding.horizontal,c-=l.padding.vertical),$a.css({width:b+"px",height:c+"px"})}L=!1}),$a.css({"z-index":"2",opacity:1}),_a&&_a.css("z-index","1"),r?$a.css({display:"block",width:"100%",height:"100%"}):$a.fadeIn(Z.popupResizeTime,function(){_a&&_a.css("display","none"),A&&cb(function(){Z.autoHideInfo!==!1&&(u=setTimeout(function(){db()},Z.titleDisplayDuration))}),z>1&&(Z.cacheImagesInBackground&&!e.cacheComplete&&Sa(j+(e.cacheDirectionForward?1:-1)),K&&Xa())})}function ib(a,b,c,d,e){jQuery.jsonp({url:T[a]||"http://oohembed.com/oohembed/",data:jQuery.extend({url:b,format:"json"},c),dataType:"jsonp",callbackParameter:"callback",success:function(a){var b={title:a.title,width:a.width,height:a.height,type:a.type};"video"===a.type?b.html=a.html.replace(/<embed /,'<embed wmode="transparent" ').replace(/<param/,'<param name="wmode" value="transparent"><param').replace(/width=\"[\d]+\"/gi,'width="100%"').replace(/height=\"[\d]+\"/gi,'height="100%"'):"photo"===a.type&&jQuery.extend(b,{src:a.url,alt:a.title,type:"image"}),d(b)},error:function(a,b){e&&e(a,b)}})}function jb(b){try{if(!b)throw"Error: Media is unavailable.";"image"!==b.contentType&&b.contentType?b.loaded||"ooembed"!=b.contentType?hb(a.yoxview.currentImage.media):kb(b,function(a){hb(a)},function(a){lb("Error getting data from:<br /><span class='errorUrl'>"+a.data.url+"</span>")}):(a.support.opacity&&(ma.src=""),ma.src=b.src)}catch(a){lb(a)}}function kb(b,c,d){"ooembed"==b.contentType&&ib(b.provider,b.url,Z.defaultDimensions.video,function(d){a.extend(b,d,{loaded:!0}),c&&c(b)},d)}function lb(a){hb({html:"<span class='yoxview_error'>"+a+"</span>",width:500,height:300,type:"error",title:""})}var b=b||Yox.getPath(/(.*\/)jquery\.yoxview/i),c={autoHideInfo:!0,autoPlay:!1,backgroundColor:"#000000",backgroundOpacity:.8,buttonsFadeTime:300,cacheBuffer:5,cacheImagesInBackground:!0,controlsInitialFadeTime:1500,controlsInitialDisplayTime:1e3,dataFolder:b+"data/",defaultDimensions:{flash:{width:720,height:560},iframe:{width:1024}},flashVideoPlayer:"jwplayer",imagesFolder:b+"images/",infoBackColor:"#000000",infoBackOpacity:.5,isRTL:!1,lang:"en",langFolder:b+"lang/",loopPlay:!0,playDelay:3e3,popupMargin:20,popupResizeTime:600,renderButtons:!0,renderMenu:!0,showBarsOnOpen:!0,showButtonsOnOpen:!0,showDescription:!0,textLinksSelector:".yoxviewLink",thumbnailsOptions:{thumbnailsClass:"yoxview_thumbnail"},titleAttribute:"title",titleDisplayDuration:2e3};this.infoButtons={},this.isOpen=!1,this.yoxviewSkins={};var d,g,h,m,s,t,u,v,w,x,y,A,B,C,E,F,G,H,O,V,W,X,Y,Z,_,aa,ba,ca,da,ga,ia,ja,la,na,pa,qa,ra,ua,e={},f=new Image,i=0,j=0,k={},l={},n=0,o=window!=window.parent,p=!1,q={wmode:"transparent",width:"100%",height:"100%",allowfullscreen:"true",allowscriptaccess:"true",hasVersion:9},r=!0,z=0,D=30,I=!1,J=!0,K=!1,L=!1,N=[],P=!1,Q={width:100,height:100},S="yoxview_mediaPanel",T={vimeo:"http://vimeo.com/api/oembed.json",myspace:"http://vids.myspace.com/index.cfm?fuseaction=oembed"},U=-42,$=[],ea={},fa={},ha=a(Yox.getTopWindow()),ka=!1,ma=new Image,sa={},ta={40:"DOWN",35:"END",13:"ENTER",36:"HOME",37:"LEFT",39:"RIGHT",32:"SPACE",38:"UP",72:"h",27:"ESCAPE"};this.init=function(b,d){function g(){b.each(function(b,c){c=a(c);var d=N.length;c.data("yoxview",{viewIndex:d,cacheVars:{cachedImagesCount:0,cacheDirectionForward:!0,cacheBufferLastIndex:null,currentCacheImg:0}});var g=c.data("yoxview");f&&(g.optionsSet=f),e.allowedImageUrls=[Yox.Regex.image],e.allowedUrls&&(e.allowedImageUrls=e.allowedImageUrls.concat(e.allowedUrls));var h="A"==c[0].tagName,i=h?c:c.find(wa(e)),j=[],k=0;i.each(function(b,c){var f=a(c),g=Da(f,e);g&&(j.push(g),h?f.data("yoxview").imageIndex=k:f.data("yoxview",{imageIndex:k,viewIndex:d}),k++)}),e.images&&(j=j.concat(e.images)),e.dataSource?Yox.dataSources[e.dataSource].getImagesData(e,function(b){j=j.concat(b.images),g.images=j,b.title&&e.thumbnailsOptions&&e.thumbnailsOptions.setHeader&&a(e.thumbnailsOptions.headerElement||"<h2>",{html:b.title,class:e.thumbnailsOptions.headerClass}).appendTo(c);var f=b.isGroup?[a.extend(b,{media:{title:b.title+" ("+b.images.length+" images)",alt:b.title}})]:b.images;Ea(c,e,h?null:f,b.createGroups?function(b){var c=a(b.currentTarget).data("yoxview"),d=a(b.currentTarget),f=d.data("yoxthumbs");if(c.imagesAreSet)a.yoxview.open(c.viewIndex);else{d.css("cursor","wait");var g=a.extend({},e);g.dataSourceOptions?a.extend(g.dataSourceOptions,f):g.dataSourceOptions=f,Yox.dataSources[e.dataSource].getImagesData(g,function(b){c.images=b.images,c.imagesAreSet=!0,d.css("cursor",""),a.yoxview.open(c.viewIndex)})}}:null),b.createGroups?a.each(c.yoxthumbs("thumbnails"),function(b,c){c.data("yoxview",{viewIndex:++d}),N.push(a(c))}):a.each(c.yoxthumbs("thumbnails"),function(a,b){var c=k+a,e=b.children("img");0==e.length&&(e=b),j[c].thumbnailImg=e,b.data("yoxview",{imageIndex:a,viewIndex:d})}),!a.yoxview.firstViewWithImages&&b.images.length>0&&(a.yoxview.firstViewWithImages=c,e.cacheImagesInBackground&&a.yoxview.startCache())}):(g.images=j,Ea(c,e)),N.push(c),!a.yoxview.firstViewWithImages&&g.images&&0!=g.images&&(a.yoxview.firstViewWithImages=c,Aa(c),e.cacheImagesInBackground&&0!=z&&(Ra(),Sa(0)))})}var f,e=a.extend(!0,{},c,d);0==$.length?($.push(e),f=0):f=d?va(e):null,ya(e.lang,function(b){xa(e,function(b){b&&b.options&&a.extend(e,b.options),Yox.loadDataSource(e,g)})})};var Ca={image:function(a,b,c,d){for(var e=null,f=0;f<d.allowedImageUrls.length&&!e;f++)b.match(d.allowedImageUrls[f])&&(e={src:a.attr("href"),title:c.attr(d.titleAttribute),alt:c.attr("alt")});return e},flash:function(b,c,d,e){var f=null,g=c.match(Yox.Regex.flash),h=g?null:c.match(Yox.Regex.flashvideo);if(g||h){var i=Yox.getUrlData(c),j=Ba("flash",i.queryFields,e);i.queryFields&&(delete i.queryFields.width,delete i.queryFields.height);var k=a("<div>",{class:"yoxview_element",html:"<div class='yoxview_error'>Please install the latest version of the <a href='http://www.adobe.com/go/getflashplayer' target='_blank'>Flash player</a> to view content</div>"}),l=h?Yox.flashVideoPlayers[e.flashVideoPlayer](e.flashVideoPlayerPath,i.path,i.queryFields&&i.queryFields.image?i.queryFields.image:"IMG"==d[0].nodeName?d.attr("src"):null,d.attr(e.titleAttribute)):i.queryFields||{};g&&(l.swf=i.path),a.extend(l,q),k.flash(l),f={element:k,title:d.attr(e.titleAttribute)},a.extend(f,j)}return f},ooembed:function(a,b,c,d){var e=null;for(videoProvider in Yox.Regex.video)if(b.match(Yox.Regex.video[videoProvider])){e={provider:videoProvider,url:b};break}return e},inline:function(b,c,d,e){if(!e.allowInternalLinks)return null;var f=null,g=Yox.getUrlData(c);if(g&&g.anchor){var h=a("#"+g.anchor);if(0!=h.length){var i={width:parseInt(h.css("width")),height:parseInt(h.css("height"))};h.css({position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"block"}),f={type:"inlineElement",element:h,title:h.attr("title")};var j={horizontal:parseInt(h.css("padding-right"))+parseInt(h.css("padding-left")),vertical:parseInt(h.css("padding-top"))+parseInt(h.css("padding-bottom"))};i.width=isNaN(i.width)?null:i.width+j.horizontal,i.height=isNaN(i.height)?null:i.height+j.vertical,a.extend(f,i),0==j.horizontal&&0==j.vertical||(f.padding=j),h.remove()}}return f},iframe:function(b,c,d,e){var f=null,g=b.attr("target");if(g&&"yoxview"==g){var h=Yox.getUrlData(c);if(h&&h.path){var i=Ba("iframe",h.queryFields,e);h.queryFields&&(delete h.queryFields.width,delete h.queryFields.height),f={element:a("<iframe>",{src:Yox.urlDataToPath(h),class:"yoxview_element"}),title:d.attr("title"),frameborder:"0"},a.extend(f,i)}}return f}};this.open=function(b,c,d){var e=this instanceof jQuery;if(e){b&&"function"==typeof b&&(d=b);var f=this.data("yoxview");b=f.viewIndex,c=f.imageIndex}else"function"==typeof b?(d=b,b=c=0):"function"==typeof c&&(d=c,c=0);return b=b||0,c=c||0,a(document).bind("keydown.yoxview",Ka),Aa(N[b]),ca||0==z||Oa(),a.yoxview.selectImage(c),ia.stop().css({opacity:0,display:"block"}).animate({opacity:1},"slow",function(){ia.css("opacity","")}),Z.cacheImagesInBackground&&Sa(c),d&&(Y=d),!!e&&this},this.selectImage=function(b){a.yoxview.currentImage=y[b],j=b,Fa(!0),na.blur(),_.css({"z-index":"1",width:"100%",height:"100%"}),aa.css({display:"none","z-index":"2"}),r=!0,ca.css(qa),this.select(b)},this.refresh=function(){ka=K,K&&Ya(),Va(j),ka&&Xa()},this.options=function(b,c){if(!b)return this;if(c&&"string"==typeof b){var d=b;b={},b[d]=c}if(this instanceof jQuery){var e=this.data("yoxview");return e&&(a.extend($[e.optionsSet||0],b),this.yoxview("update")),this}a.each($,function(c,d){a.extend(d,b)}),a.yoxview.update()},this.select=function(b,c,d){if("number"==typeof c&&(d=c,c=void 0),d=d||0,!L){if(b<0){if(b=z-1,Z.onEnd)return void Z.onEnd()}else if(b==z&&(b=0,Z.onEnd))return void Z.onEnd();!K&&c&&Ga(c),a.yoxview.currentImage=y[b],j=b,Va(j),Ra(),Z.onSelect&&Z.onSelect(b,y[b])}},this.prev=function(a){e.cacheDirectionForward=!1,this.select(j-1,ja),K&&a!==!0&&Ya()},this.next=function(a){e.cacheDirectionForward=!0,this.select(j+1,W),K&&a!==!0&&Ya()},this.first=function(){Z.disableNotifications||Ha("first"),this.select(0),K&&Ya()},this.last=function(){Z.disableNotifications||Ha("last"),this.select(z-1),K&&Ya()},this.setDefaults=function(b){a.extend(!0,c,b)},this.play=function(){this.isOpen&&1!=z&&(e.cacheDirectionForward=!0,K?(Z.disableNotifications||Ha("pause"),Ya()):(Z.disableNotifications||Ha("play"),Xa()))},this.close=function(){this.isOpen&&(this.closeHelp(),Fa(!1),Wa(qa,function(){a.yoxview.isOpen=!1}),eb(),A&&db(function(){H.html("")}),$a.animate({width:qa.width,height:qa.height},Z.popupResizeTime,function(){$a.css("opacity",1)}),ia.stop().fadeOut(1e3),K&&Ya(),gb(),Z.onClose&&Z.onClose(),a(document).unbind("keydown.yoxview"),L=!1)},this.help=function(){this.isOpen&&("none"==t.css("display")?t.css("display","block").stop().animate({opacity:.8},Z.buttonsFadeTime):this.closeHelp())},this.closeHelp=function(){"none"!=t.css("display")&&t.stop().animate({opacity:0},Z.buttonsFadeTime,function(){t.css("display","none")})},this.clickBtn=function(a,b){return b&&K&&Ya(),a.call(this),!1},ha.bind("resize.yoxview",function(){ra=ab(),a.yoxview.isOpen&&a.yoxview.resize()}),a(f).load(function(){a.extend(y[e.currentCacheImg].media,{width:this.width,height:this.height,loaded:!0}),Pa()}).error(function(){Pa()}),this.startCache=function(){Aa(this.firstViewWithImages),Ra(),Sa(0)};var $a=aa,_a=_;this.resize=function(a){K&&(ka=!0,Ya());var b=bb(l);$a.css({width:"100%",height:"100%"}),L=!0,J||h.css({top:Math.round((b.height-Q.height)/2)}),Wa(b,function(){var b={width:ca.width(),height:ca.height()};l.padding&&(b.width-=l.padding.horizontal,b.height-=l.padding.vertical),$a.css(b),L=!1,A&&a!==!1&&cb(),ka&&(Xa(),ka=!1)})},a(ma).load(function(){return 0==this.width?void lb("Image error"):void hb(a.extend({},a.yoxview.currentImage.media,{width:this.width,height:this.height}))}).error(function(){lb("Image not found:<br /><span class='errorUrl'>"+this.src+"</span>")}),this.update=function(){var b;return this instanceof jQuery?(b=$[this.data("yoxview").optionsSet||0],this.yoxview("unload",function(a){a.yoxview(b)}),this):(b=$[0],this.unload(),a.each(N,function(a,c){c.yoxview(b)}),void 0)},this.unload=function(a){function c(){function d(a){a.undelegate(c,"click.yoxview").removeData("yoxview").yoxthumbs("unload","yoxview").find(c).removeData("yoxview")}function e(){ha.unbind(".yoxview"),ca&&(ia.remove(),ca=void 0)}var c=wa(Z);return b instanceof jQuery?b.data("yoxview")&&d(b):(jQuery.each(N,function(a,b){d(b)}),e()),a?void a(b):b}var b=this;return Z?void(Z.onBeforeUnload?Z.onBeforeUnload(c):c()):this}}a.yoxview||(a.yoxview=new b),a.fn.yoxview=function(b){if(0!=this.length){if(a.yoxview[b])return a.yoxview[b].apply(this,Array.prototype.slice.call(arguments,1));"object"!=typeof b&&b?a.error("Method "+b+" does not exist on YoxView."):a.yoxview.init(this,b)}return this},a(Yox.getTopWindow()).unload(function(){a.yoxview&&(a.yoxview.unload(),delete a.yoxview)})}(jQuery);